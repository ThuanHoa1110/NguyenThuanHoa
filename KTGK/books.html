<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω Kho S√°ch</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navbar -->
    <div class="navbar">
        <div class="navbar-left">
            <span>üìö</span> Qu·∫£n l√Ω Kho S√°ch
        </div>
        <div class="navbar-right">
            <a href="#" class="active" id="link-list">Danh s√°ch s√°ch</a>
            <a href="#" id="link-add">+ Th√™m s√°ch m·ªõi</a>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats" id="statsBar">
        <!-- JS render -->
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Search -->
        <div class="search-bar">
            <span class="search-icon">üîç</span>
            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm s√°ch theo ti√™u ƒë·ªÅ, t√°c gi·∫£, th·ªÉ lo·∫°i...">
        </div>
        <!-- Table -->
        <table class="table-books" id="booksTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Ti√™u ƒë·ªÅ</th>
                    <th>T√°c gi·∫£</th>
                    <th>NƒÉm XB</th>
                    <th>Th·ªÉ lo·∫°i</th>
                    <th>S·ªë trang</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody>
                <!-- JS render -->
            </tbody>
        </table>
        <div id="emptyMsg" style="color:#888;text-align:center;margin:20px 0 0 0;"></div>
    </div>

    <!-- Popup Modal Form -->
    <div class="modal-bg" id="modalBg">
        <form class="modal" id="bookForm" autocomplete="off">
            <button type="button" class="close-modal" id="closeModal">&times;</button>
            <h2 id="modalTitle">Th√™m s√°ch m·ªõi</h2>
            <input type="hidden" id="bookId">
            <label>Ti√™u ƒë·ªÅ s√°ch *</label>
            <input type="text" id="title">
            <div class="error" id="err-title"></div>

            <label>T√°c gi·∫£ *</label>
            <input type="text" id="author">
            <div class="error" id="err-author"></div>

            <div style="display: flex; gap: 10px;">
                <div style="flex:1">
                    <label>NƒÉm xu·∫•t b·∫£n *</label>
                    <input type="number" id="year" min="1900" max="2025">
                    <div class="error" id="err-year"></div>
                </div>
                <div style="flex:1">
                    <label>S·ªë trang *</label>
                    <input type="number" id="pages" min="1">
                    <div class="error" id="err-pages"></div>
                </div>
            </div>

            <label>Th·ªÉ lo·∫°i *</label>
            <select id="category">
                <option value="">Ch·ªçn th·ªÉ lo·∫°i</option>
                <option>VƒÉn h·ªçc</option>
                <option>Khoa h·ªçc</option>
                <option>C√¥ng ngh·ªá</option>
                <option>Thi·∫øu nhi</option>
            </select>
            <div class="error" id="err-category"></div>

            <label>M·∫≠t kh·∫©u qu·∫£n tr·ªã *</label>
            <input type="password" id="adminPass" placeholder="T·ªëi thi·ªÉu 8 k√Ω t·ª±, 1 hoa, 1 th∆∞·ªùng, 1 s·ªë, 1 ƒë·∫∑c bi·ªát">
            <div class="error" id="err-adminPass"></div>
            <label>X√°c nh·∫≠n m·∫≠t kh·∫©u *</label>
            <input type="password" id="adminPass2">
            <div class="error" id="err-adminPass2"></div>
            <div class="modal-actions">
                <button type="button" class="btn" id="cancelBtn">H·ªßy</button>
                <button type="submit" class="btn btn-add" id="submitBtn">Th√™m s√°ch</button>
            </div>
        </form>
    </div>
    <script>
    // === Helper Functions ===
    function getBooks() { return JSON.parse(localStorage.getItem('books') || '[]'); }
    function setBooks(books) { localStorage.setItem('books', JSON.stringify(books)); }
    function validatePassword(pw) {
        return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*]).{8,}$/.test(pw);
    }

    // === Modal Handling ===
    const modalBg = document.getElementById('modalBg');
    const openModalBtn = document.getElementById('link-add');
    const closeModalBtn = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    function openModal(editBook=null) {
        modalBg.classList.add('active');
        document.getElementById('bookForm').reset();
        for (let id of ['title','author','year','pages','category','adminPass','adminPass2'])
            document.getElementById('err-' + id).textContent = '';
        document.getElementById('modalTitle').textContent = editBook ? 'Ch·ªânh s·ª≠a s√°ch' : 'Th√™m s√°ch m·ªõi';
        document.getElementById('submitBtn').textContent = editBook ? 'C·∫≠p nh·∫≠t' : 'Th√™m s√°ch';
        if(editBook) {
            document.getElementById('bookId').value = editBook.id;
            document.getElementById('title').value = editBook.title;
            document.getElementById('author').value = editBook.author;
            document.getElementById('year').value = editBook.year;
            document.getElementById('pages').value = editBook.pages;
            document.getElementById('category').value = editBook.category;
        } else {
            document.getElementById('bookId').value = '';
        }
    }
    function closeModal() {
        modalBg.classList.remove('active');
    }
    openModalBtn.onclick = () => openModal();
    closeModalBtn.onclick = cancelBtn.onclick = closeModal;

    // === Render Stats ===
    function renderStats() {
        const books = getBooks();
        let categories = {};
        let yearMax = 0;
        let totalPages = 0;
        books.forEach(b => {
            categories[b.category] = true;
            if(+b.year > yearMax) yearMax = +b.year;
            totalPages += +b.pages;
        });
        document.getElementById('statsBar').innerHTML = `
            <div class="stat-card">
                <div class="stat-value">${books.length}</div>
                <div class="stat-label">T·ªïng s·ªë s√°ch</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${Object.keys(categories).length}</div>
                <div class="stat-label">Th·ªÉ lo·∫°i</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${yearMax || '-'}</div>
                <div class="stat-label">NƒÉm xu·∫•t b·∫£n m·ªõi nh·∫•t</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${totalPages}</div>
                <div class="stat-label">T·ªïng s·ªë trang</div>
            </div>
        `;
    }

    // === Render Books Table ===
    function renderBooks(filter='') {
        let books = getBooks();
        // Filter
        if (filter) {
            books = books.filter(b =>
                b.title.toLowerCase().includes(filter) ||
                b.author.toLowerCase().includes(filter) ||
                b.category.toLowerCase().includes(filter)
            );
        }
        const tbody = document.querySelector('#booksTable tbody');
        tbody.innerHTML = '';
        if (books.length === 0) {
            document.getElementById('emptyMsg').textContent = "Kh√¥ng c√≥ s√°ch n√†o ph√π h·ª£p.";
            return;
        } else {
            document.getElementById('emptyMsg').textContent = "";
        }
        books.forEach((book, idx) => {
            let tr = document.createElement('tr');
            tr.innerHTML = `
                <td>#${book.id.toString().slice(-4).padStart(4, '0')}</td>
                <td>${book.title}</td>
                <td>${book.author}</td>
                <td>${book.year}</td>
                <td><span class="badge ${book.category.replace(' ','_')}">${book.category}</span></td>
                <td>${book.pages} trang</td>
                <td>
                    <button class="btn btn-edit" onclick="editBook('${book.id}')">S·ª≠a</button>
                    <button class="btn btn-delete" onclick="deleteBook('${book.id}')">X√≥a</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
    }
    // Edit Book
    window.editBook = function(id) {
        const books = getBooks();
        const book = books.find(b => b.id == id);
        openModal(book);
    }
    // Delete Book
    window.deleteBook = function(id) {
        if (confirm('X√°c nh·∫≠n x√≥a s√°ch n√†y?')) {
            let books = getBooks().filter(b => b.id != id);
            setBooks(books);
            renderStats(); renderBooks(document.getElementById('searchInput').value.trim().toLowerCase());
        }
    }
    // Search
    document.getElementById('searchInput').oninput = function() {
        renderBooks(this.value.trim().toLowerCase());
    }

    // === Handle Form Submit ===
    document.getElementById('bookForm').onsubmit = function(e) {
        e.preventDefault();
        for (let id of ['title','author','year','pages','category','adminPass','adminPass2'])
            document.getElementById('err-' + id).textContent = '';
        // L·∫•y d·ªØ li·ªáu
        const id = document.getElementById('bookId').value || Date.now();
        const title = document.getElementById('title').value.trim();
        const author = document.getElementById('author').value.trim();
        const year = +document.getElementById('year').value;
        const pages = +document.getElementById('pages').value;
        const category = document.getElementById('category').value;
        const adminPass = document.getElementById('adminPass').value;
        const adminPass2 = document.getElementById('adminPass2').value;

        let ok = true;
        if (!title) { document.getElementById('err-title').textContent = 'Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.'; ok=false; }
        else if (title.length > 100) { document.getElementById('err-title').textContent = 'T·ªëi ƒëa 100 k√Ω t·ª±.'; ok=false;}
        if (!author) { document.getElementById('err-author').textContent = 'Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.'; ok=false;}
        if (!year || year < 1900 || year > 2025) { document.getElementById('err-year').textContent = 'NƒÉm ph·∫£i t·ª´ 1900 ƒë·∫øn 2025.'; ok=false;}
        if (!pages || pages < 1 || !Number.isInteger(pages)) { document.getElementById('err-pages').textContent = 'S·ªë nguy√™n > 0.'; ok=false;}
        if (!category) { document.getElementById('err-category').textContent = 'Ch·ªçn th·ªÉ lo·∫°i.'; ok=false;}
        if (!adminPass) { document.getElementById('err-adminPass').textContent = 'Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.'; ok=false;}
        else if (!validatePassword(adminPass)) { document.getElementById('err-adminPass').textContent = '√çt nh·∫•t 8 k√Ω t·ª±, g·ªìm ch·ªØ hoa, ch·ªØ th∆∞·ªùng, s·ªë v√† k√Ω t·ª± ƒë·∫∑c bi·ªát.'; ok=false;}
        if (!adminPass2) { document.getElementById('err-adminPass2').textContent = 'Kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.'; ok=false;}
        else if (adminPass2 !== adminPass) { document.getElementById('err-adminPass2').textContent = 'M·∫≠t kh·∫©u kh√¥ng kh·ªõp.'; ok=false;}
        if (!ok) return;
        // L∆∞u
        let books = getBooks();
        let newBook = { id, title, author, year, category, pages };
        let existed = books.some(b => b.id == id);
        if (existed) {
            books = books.map(b => b.id == id ? newBook : b);
        } else {
            books.push(newBook);
        }
        setBooks(books);
        closeModal();
        renderStats(); renderBooks(document.getElementById('searchInput').value.trim().toLowerCase());
    };

    // Init
    renderStats(); renderBooks();

    // ESC close popup
    window.addEventListener('keydown', e => {
        if (e.key === 'Escape' && modalBg.classList.contains('active')) closeModal();
    });
    </script>
</body>
</html>
